{"version":3,"file":"h.js","sources":["../h/src/api.js","../h/src/add.js","../h/src/property.js","../h/src/index.js","../h/src/h.js","../h/src/insert.js","../h/src/remove-nodes.js"],"sourcesContent":["/**\n * Internal API.\n * Consumer must provide an observable at api.subscribe<T>(observer: () => T).\n *\n * @typedef {boolean} hSVG Determines if `h` will build HTML or SVG elements\n * @type {{\n * h:         import('./h.js').hTag\n * s:         hSVG\n * insert:    import('./insert.js').hInsert\n * property:  import('./property.js').hProperty\n * add:       import('./add.js').hAdd\n * rm:        import('./remove-nodes.js').hRemoveNodes\n * subscribe: (observer: () => *) => void\n * }}\n */\n// @ts-ignore Object is populated in index.js\nexport const api = {};\n","import { api } from './api.js';\n\n/** @type {[]} Instead of `any[]` */\nconst EMPTY_ARR = [];\n\n/** @type {(value: *) => Text | Node | DocumentFragment} */\nconst castNode = (value) => {\n  if (typeof value === 'string') {\n    return document.createTextNode(value);\n  }\n  // Note that a DocumentFragment is an instance of Node\n  if (!(value instanceof Node)) {\n    // Passing an empty array creates a DocumentFragment\n    // Note this means api.add is not purely a subcall of api.h; it can nest\n    return api.h(EMPTY_ARR, value);\n  }\n  return value;\n};\n\n/**\n * @typedef {{ _startMark: Text }} Frag\n * @type {(value: Text | Node | DocumentFragment) => (Node | Frag)?}\n */\nconst frag = (value) => {\n  const { childNodes } = value;\n  if (!childNodes || value.nodeType !== 11) return;\n  if (childNodes.length < 2) return childNodes[0];\n  // For a fragment of 2 elements or more add a startMark. This is required for\n  // multiple nested conditional computeds that return fragments.\n\n  // It looks recursive here but the next call's fragOrNode is only Text('')\n  return { _startMark: /** @type {Text} */ (api.add(value, '', childNodes[0])) };\n};\n\n/**\n * Add a string or node before a reference node or at the end.\n * @typedef {Node | string | number} Value\n * @typedef {(parent: Node, value: Value | Value[], endMark: Node?) => Node | Frag} hAdd\n * @type {hAdd}\n */\nexport const add = (parent, value, endMark) => {\n  value = castNode(value);\n  const fragOrNode = frag(value) || value;\n\n  // If endMark is `null`, value will be added to the end of the list.\n  parent.insertBefore(value, endMark && endMark.parentNode && endMark);\n  return fragOrNode;\n};\n","import { api } from './api.js';\n\n/**\n * Proxy an event to hooked event handlers.\n * @this Node & { _listeners: { [name: string]: (ev: Event) => * } }\n * @type {(e: Event) => *}\n */\nfunction eventProxy(e) {\n  // eslint-disable-next-line fp/no-this\n  return this._listeners && this._listeners[e.type](e);\n}\n\n/**\n * @type {(el: Node, name: string, value: (ev: Event?) => *) => void}\n */\nconst handleEvent = (el, name, value) => {\n  name = name.slice(2).toLowerCase();\n\n  if (value) {\n    el.addEventListener(name, eventProxy);\n  } else {\n    el.removeEventListener(name, eventProxy);\n  }\n\n  (el._listeners || (el._listeners = {}))[name] = value;\n};\n\n/**\n * @typedef {(el: Node, value: *, name: string, isAttr: boolean?, isCss: boolean?) => void} hProperty\n * @type {hProperty}\n */\nexport const property = (el, value, name, isAttr, isCss) => {\n  // eslint-disable-next-line eqeqeq\n  if (value == null) return;\n  if (!name || (name === 'attrs' && (isAttr = true))) {\n    for (name in value) {\n      api.property(el, value[name], name, isAttr, isCss);\n    }\n  } else if (name[0] === 'o' && name[1] === 'n' && !value.$o) {\n    // Functions added as event handlers are not executed\n    // on render unless they have an observable indicator.\n    handleEvent(el, name, value);\n  } else if (typeof value === 'function') {\n    api.subscribe(() => {\n      api.property(el, value.call({ el, name }), name, isAttr, isCss);\n    });\n  } else if (isCss) {\n    el.style.setProperty(name, value);\n  } else if (\n    isAttr\n    || name.slice(0, 5) === 'data-'\n    || name.slice(0, 5) === 'aria-'\n  ) {\n    el.setAttribute(name, value);\n  } else if (name === 'style') {\n    if (typeof value === 'string') {\n      el.style.cssText = value;\n    } else {\n      api.property(el, value, null, isAttr, true);\n    }\n  } else {\n    if (name === 'class') name += 'Name';\n    el[name] = value;\n  }\n};\n","/* Adapted from DOM Expressions - The MIT License - Ryan Carniato */\nimport { api } from './api.js';\n\nimport { h } from './h.js';\nimport { add } from './add.js';\nimport { insert } from './insert.js';\nimport { property } from './property.js';\nimport { removeNodes } from './remove-nodes.js';\n\napi.h = h;\napi.insert = insert;\napi.property = property;\napi.add = add;\napi.rm = removeNodes;\n\nexport { api };\n","/* Adapted from Hyper DOM Expressions - The MIT License - Ryan Carniato */\nimport { api } from './api.js';\n\n/**\n * Sinuous `h` tag aka hyperscript.\n * @typedef {HTMLElement | SVGElement | DocumentFragment} DOM\n * @typedef {(tag: string? | [], props: object?, ...children: Node | *) => DOM} hTag\n * @type {hTag}\n */\n\nexport const h = (...args) => {\n  let el;\n  const item = (/** @type {*} */ arg) => {\n    // @ts-ignore Allow empty if\n    // eslint-disable-next-line eqeqeq\n    if (arg == null);\n    else if (typeof arg === 'string') {\n      if (el) {\n        api.add(el, arg);\n      } else {\n        el = api.s\n          ? document.createElementNS('http://www.w3.org/2000/svg', arg)\n          : document.createElement(arg);\n      }\n    } else if (Array.isArray(arg)) {\n      // Support Fragments\n      if (!el) el = document.createDocumentFragment();\n      arg.forEach(item);\n    } else if (arg instanceof Node) {\n      if (el) {\n        api.add(el, arg);\n      } else {\n        // Support updates\n        el = arg;\n      }\n    } else if (typeof arg === 'object') {\n      // @ts-ignore 0 | 1 is a boolean but can't type cast; they don't overlap\n      api.property(el, arg, null, api.s);\n    } else if (typeof arg === 'function') {\n      if (el) {\n        // See note in add.js#frag() - This is a Text('') node\n        const endMark = /** @type {Text} */ (api.add(el, ''));\n        api.insert(el, arg, endMark);\n      } else {\n        // Support Components\n        el = arg.apply(null, args.splice(1));\n      }\n    } else {\n      // eslint-disable-next-line no-implicit-coercion,prefer-template\n      api.add(el, '' + arg);\n    }\n  };\n  args.forEach(item);\n  return el;\n};\n","import { api } from './api.js';\n\n/**\n * @typedef {import('./add.js').Frag} Frag\n * @typedef {(el: Node, value: *, endMark: Node?, current: (Node | Frag)?,\n * startNode: Node?) => Node | Frag } hInsert\n * @type {hInsert}\n */\nexport const insert = (el, value, endMark, current, startNode) => {\n  // This is needed if the el is a DocumentFragment initially.\n  el = (endMark && endMark.parentNode) || el;\n\n  // Save startNode of current. In clear() endMark.previousSibling is not always\n  // accurate if content gets pulled before clearing.\n  startNode = startNode || current instanceof Node && current;\n\n  // @ts-ignore Allow empty if statement\n  if (value === current);\n  else if (\n    (!current || typeof current === 'string')\n    // @ts-ignore Doesn't like `value += ''`\n    // eslint-disable-next-line no-implicit-coercion\n    && (typeof value === 'string' || (typeof value === 'number' && (value += '')))\n  ) {\n    // Block optimized for string insertion.\n    // eslint-disable-next-line eqeqeq\n    if (current == null || !el.firstChild) {\n      if (endMark) {\n        api.add(el, value, endMark);\n      } else {\n        // Using textContent is a lot faster than append -> createTextNode.\n        el.textContent = /** @type {string} See `value += '' */ (value);\n      }\n    } else {\n      if (endMark) {\n        (endMark.previousSibling || el.lastChild).data = value;\n      } else {\n        el.firstChild.data = value;\n      }\n    }\n    current = value;\n  } else if (typeof value === 'function') {\n    api.subscribe(() => {\n      current = api.insert(el, value.call({ el, endMark }), endMark, current, startNode);\n    });\n  } else {\n    // Block for nodes, fragments, Arrays, non-stringables and node -> stringable.\n    if (endMark) {\n      // `current` can't be `0`, it's coerced to a string in insert.\n      if (current) {\n        if (!startNode) {\n          // Support fragments\n          startNode = (current._startMark && current._startMark.nextSibling)\n            || endMark.previousSibling;\n        }\n        api.rm(el, startNode, endMark);\n      }\n    } else {\n      el.textContent = '';\n    }\n    current = null;\n\n    if (value && value !== true) {\n      current = api.add(el, value, endMark);\n    }\n  }\n\n  return current;\n};\n","/**\n * Removes nodes, starting from `startNode` (inclusive) to `endMark` (exclusive).\n * @typedef {(parent: Node, startNode: Node, endMark: Node) => void} hRemoveNodes\n * @type {hRemoveNodes}\n */\nexport const removeNodes = (parent, startNode, endMark) => {\n  while (startNode && startNode !== endMark) {\n    const n = startNode.nextSibling;\n    // Is needed in case the child was pulled out the parent before clearing.\n    if (parent === startNode.parentNode) {\n      parent.removeChild(startNode);\n    }\n    startNode = n;\n  }\n};\n"],"names":["EMPTY_ARR","eventProxy","e","this","_listeners","type","api","h","args","arg","el","add","s","document","createElementNS","createElement","Array","isArray","createDocumentFragment","forEach","item","Node","property","insert","endMark","apply","splice","value","current","startNode","parentNode","subscribe","call","_startMark","nextSibling","previousSibling","rm","textContent","firstChild","lastChild","data","name","isAttr","isCss","$o","style","setProperty","slice","setAttribute","cssText","toLowerCase","addEventListener","removeEventListener","handleEvent","parent","childNodes","nodeType","length","frag","createTextNode","castNode","insertBefore","fragOrNode","removeChild","n"],"mappings":"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"}